<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FamilyFlame - Budget Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            font-weight: 300;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #6c757d;
            font-size: 1.1em;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            gap: 5px;
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Upload Section */
        .upload-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .upload-section:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .upload-icon {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .upload-text {
            font-size: 1.2em;
            color: #6c757d;
            margin-bottom: 10px;
        }
        
        input[type="file"] {
            display: none;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }
        
        .btn-success:hover {
            box-shadow: 0 8px 20px rgba(39, 174, 96, 0.3);
        }
        
        /* Dashboard Grid */
        .dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .main-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        /* Income Buffer System */
        .buffer-system {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .buffer-amount {
            font-size: 2.5em;
            font-weight: 600;
            text-align: center;
            margin: 15px 0;
        }
        
        .buffer-status {
            text-align: center;
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 4px solid;
        }
        
        .summary-card.income {
            border-left-color: #27ae60;
        }
        
        .summary-card.expenses {
            border-left-color: #e74c3c;
        }
        
        .summary-card.pocket {
            border-left-color: #f39c12;
        }
        
        .summary-card.savings {
            border-left-color: #3498db;
        }
        
        .summary-title {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .summary-amount {
            font-size: 1.8em;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .positive {
            color: #27ae60;
        }
        
        .negative {
            color: #e74c3c;
        }
        
        /* Allocation System */
        .allocation-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .allocation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .allocation-item:last-child {
            border-bottom: none;
        }
        
        .allocation-label {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .allocation-amount {
            font-weight: 600;
            color: #667eea;
        }
        
        /* Progress Bars */
        .progress-container {
            margin: 15px 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .progress-bar {
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        /* Transaction Table */
        .transactions-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        
        .table-header {
            background: #667eea;
            color: white;
            padding: 20px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-content {
            max-height: 400px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }
        
        .amount-positive {
            color: #27ae60;
            font-weight: 600;
        }
        
        .amount-negative {
            color: #e74c3c;
            font-weight: 600;
        }
        
        /* Status Messages */
        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .allocation-container {
                grid-template-columns: 1fr;
            }
            
            .summary-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔥 FamilyFlame</h1>
            <p class="subtitle">Keeping your family finances burning bright - Automated FIRE journey management</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">📊 Dashboard</button>
            <button class="tab" onclick="showTab('processor')">💳 Process Statements</button>
            <button class="tab" onclick="showTab('allocations')">🎯 Monthly Allocations</button>
            <button class="tab" onclick="showTab('goals')">📈 Savings Goals</button>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="buffer-system">
                <h3>💰 Income Buffer System</h3>
                <div class="buffer-amount" id="bufferAmount">€3,247</div>
                <div class="buffer-status" id="bufferStatus">Buffer is healthy - can cover 2.1 months of low income</div>
            </div>
            
            <div class="summary-grid">
                <div class="summary-card income">
                    <div class="summary-title">This Month Income</div>
                    <div class="summary-amount positive" id="dashboardIncome">€5,840</div>
                </div>
                <div class="summary-card expenses">
                    <div class="summary-title">Fixed Costs</div>
                    <div class="summary-amount" id="dashboardFixed">€5,283</div>
                </div>
                <div class="summary-card pocket">
                    <div class="summary-title">Pocket Money</div>
                    <div class="summary-amount" id="dashboardPocket">€300</div>
                </div>
                <div class="summary-card savings">
                    <div class="summary-title">Available for Savings</div>
                    <div class="summary-amount positive" id="dashboardSavings">€257</div>
                </div>
            </div>
            
            <div class="dashboard">
                <div class="main-panel">
                    <h3>📊 Monthly Overview</h3>
                    <div class="allocation-container">
                        <div class="card">
                            <h4>💶 Income Sources</h4>
                            <div class="allocation-item">
                                <span class="allocation-label">Derek Salary</span>
                                <span class="allocation-amount">€4,300</span>
                            </div>
                            <div class="allocation-item">
                                <span class="allocation-label">Derek Gift</span>
                                <span class="allocation-amount">€300</span>
                            </div>
                            <div class="allocation-item">
                                <span class="allocation-label">Iris Income</span>
                                <span class="allocation-amount" id="irisIncome">€1,240</span>
                            </div>
                            <div class="allocation-item">
                                <span class="allocation-label"><strong>Total Income</strong></span>
                                <span class="allocation-amount"><strong id="totalMonthlyIncome">€5,840</strong></span>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h4>🏠 Fixed Allocations</h4>
                            <div class="allocation-item">
                                <span class="allocation-label">VL Account (Fixed Costs)</span>
                                <span class="allocation-amount">€2,383</span>
                            </div>
                            <div class="allocation-item">
                                <span class="allocation-label">Joint Account</span>
                                <span class="allocation-amount">€1,800</span>
                            </div>
                            <div class="allocation-item">
                                <span class="allocation-label">Pocket Money (Total)</span>
                                <span class="allocation-amount">€300</span>
                            </div>
                            <div class="allocation-item">
                                <span class="allocation-label">House Maintenance</span>
                                <span class="allocation-amount">€100</span>
                            </div>
                            <div class="allocation-item">
                                <span class="allocation-label">Vacation Fund</span>
                                <span class="allocation-amount">€700</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4>🎯 Savings Allocation (Excess Income)</h4>
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>House Fund (30%)</span>
                                <span id="houseFund">€77</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 30%"></div>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>Kids Fund (25%)</span>
                                <span id="kidsFund">€64</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 25%"></div>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>Long-term Investing (45%)</span>
                                <span id="investingFund">€116</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 45%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="side-panel">
                    <div class="card">
                        <h3>⚠️ Quick Alerts</h3>
                        <div id="alertsContainer">
                            <div class="status-message status-success">
                                ✅ Income sufficient for this month
                            </div>
                            <div class="status-message status-warning">
                                ⚠️ Iris income below average - using buffer if needed
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>📅 Next Actions</h3>
                        <ul style="list-style: none; padding: 0;">
                            <li style="padding: 8px 0; border-bottom: 1px solid #eee;">
                                🔄 Process this month's statements
                            </li>
                            <li style="padding: 8px 0; border-bottom: 1px solid #eee;">
                                💸 Transfer €300 to pocket money
                            </li>
                            <li style="padding: 8px 0; border-bottom: 1px solid #eee;">
                                📈 Allocate €257 to savings goals
                            </li>
                            <li style="padding: 8px 0;">
                                📊 Review quarterly goals (in 2 weeks)
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bank Statement Processor Tab -->
        <div id="processor" class="tab-content">
            <div class="upload-section" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">📁</div>
                <div class="upload-text" id="uploadText">Click to select CAMT.053 XML files</div>
                <div style="color: #adb5bd; font-size: 0.9em;">Upload all 3 accounts at once</div>
            </div>
            <input type="file" id="fileInput" multiple accept=".xml,.XML" />
            
            <div style="text-align: center; margin: 20px 0;">
                <button class="btn" id="processBtn" disabled onclick="processStatements()">Process Bank Statements</button>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div>Processing your bank statements...</div>
            </div>
            
            <div id="processorResults" style="display: none;">
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-title">Detected Total Balance</div>
                        <div class="summary-amount" id="detectedBalance">€0.00</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">Income This Period</div>
                        <div class="summary-amount positive" id="detectedIncome">€0.00</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">Expenses This Period</div>
                        <div class="summary-amount negative" id="detectedExpenses">€0.00</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">Recommended Pocket Money</div>
                        <div class="summary-amount" id="recommendedPocket">€300</div>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 30px 0;">
                    <button class="btn btn-success" onclick="updateBudgetFromStatements()">📊 Update Budget Dashboard</button>
                    <button class="btn btn-success" onclick="exportComprehensiveData()">💾 Export Complete Analysis</button>
                </div>
                
                <div class="transactions-table">
                    <div class="table-header">
                        <span>Recent Transactions</span>
                        <span id="transactionCount">0 transactions</span>
                    </div>
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Account</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Monthly Allocations Tab -->
        <div id="allocations" class="tab-content">
            <div class="card">
                <h3>🎯 Simplified Monthly Process (15 minutes)</h3>
                
                <div class="allocation-container">
                    <div>
                        <h4>📥 Step 1: Record Income</h4>
                        <div class="allocation-item">
                            <label>Derek Total Income:</label>
                            <input type="number" id="derekIncome" value="4600" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <div class="allocation-item">
                            <label>Iris Total Income:</label>
                            <input type="number" id="irisIncomeInput" value="1240" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <div class="allocation-item">
                            <strong>Total Monthly Income: €<span id="calculatedIncome">5840</span></strong>
                        </div>
                    </div>
                    
                    <div>
                        <h4>💰 Step 2: Buffer Check</h4>
                        <div id="bufferCheck">
                            <div class="status-message status-success">
                                ✅ Income (€5,840) > Minimum (€5,400)<br>
                                Buffer action: <strong>None needed</strong>
                            </div>
                        </div>
                        <div class="allocation-item">
                            <label>Excess over €5,400:</label>
                            <span class="allocation-amount positive" id="excessAmount">€440</span>
                        </div>
                    </div>
                </div>
                
                <div style="margin: 30px 0; text-align: center;">
                    <button class="btn btn-success" onclick="calculateAllocations()">🧮 Calculate This Month's Allocations</button>
                </div>
                
                <div id="allocationResults" class="allocation-container" style="display: none;">
                    <div class="card">
                        <h4>💸 Fixed Transfers</h4>
                        <div class="allocation-item">
                            <span>VL Account (Fixed Costs)</span>
                            <span class="allocation-amount">€2,383</span>
                        </div>
                        <div class="allocation-item">
                            <span>Joint Account</span>
                            <span class="allocation-amount">€1,800</span>
                        </div>
                        <div class="allocation-item">
                            <span>Pocket Money (€150 each)</span>
                            <span class="allocation-amount">€300</span>
                        </div>
                        <div class="allocation-item">
                            <span>Fixed Savings</span>
                            <span class="allocation-amount">€700</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4>📈 Excess Allocation</h4>
                        <div class="allocation-item">
                            <span>House Fund (30%)</span>
                            <span class="allocation-amount" id="calcHouseFund">€132</span>
                        </div>
                        <div class="allocation-item">
                            <span>Kids Fund (25%)</span>
                            <span class="allocation-amount" id="calcKidsFund">€110</span>
                        </div>
                        <div class="allocation-item">
                            <span>Long-term Investing (45%)</span>
                            <span class="allocation-amount" id="calcInvestingFund">€198</span>
                        </div>
                        <div class="allocation-item">
                            <strong>Total Additional Savings: <span id="totalAdditionalSavings">€440</span></strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Savings Goals Tab -->
        <div id="goals" class="tab-content">
            <div class="summary-grid">
                <div class="card">
                    <h3>🏠 House Fund</h3>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Current: €1,352</span>
                            <span>Goal: €5,000</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 27%"></div>
                        </div>
                    </div>
                    <p style="margin-top: 10px; color: #6c757d; font-size: 0.9em;">
                        At €132/month: 2.3 years to goal
                    </p>
                </div>
                
                <div class="card">
                    <h3>👶 Kids Fund (Combined)</h3>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Current: €1,974</span>
                            <span>Goal: €10,000</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 20%"></div>
                        </div>
                    </div>
                    <p style="margin-top: 10px; color: #6c757d; font-size: 0.9em;">
                        At €110/month: 6.1 years to goal
                    </p>
                </div>
                
                <div class="card">
                    <h3>📈 Long-term Investing</h3>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Current: €3,637</span>
                            <span>Goal: €25,000</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 15%"></div>
                        </div>
                    </div>
                    <p style="margin-top: 10px; color: #6c757d; font-size: 0.9em;">
                        At €198/month: 9.0 years to goal
                    </p>
                </div>
                
                <div class="card">
                    <h3>💰 Emergency Buffer</h3>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Current: €3,247</span>
                            <span>Target: €4,000</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 81%"></div>
                        </div>
                    </div>
                    <p style="margin-top: 10px; color: #6c757d; font-size: 0.9em;">
                        Almost there! €753 remaining
                    </p>
                </div>
            </div>
            
            <div class="card">
                <h3>🎯 Progress Summary</h3>
                <p style="margin-bottom: 20px; font-size: 1.1em;">
                    Based on your current income of €5,840/month and optimized allocation strategy:
                </p>
                
                <div class="allocation-container">
                    <div>
                        <h4>Monthly Automatic Savings</h4>
                        <div class="allocation-item">
                            <span>Base savings (vacation, etc.)</span>
                            <span class="allocation-amount">€700</span>
                        </div>
                        <div class="allocation-item">
                            <span>Excess allocation</span>
                            <span class="allocation-amount">€440</span>
                        </div>
                        <div class="allocation-item">
                            <strong>Total Monthly Savings: €1,140</strong>
                        </div>
                    </div>
                    
                    <div>
                        <h4>Annual Projection</h4>
                        <div class="allocation-item">
                            <span>Total yearly savings</span>
                            <span class="allocation-amount">€13,680</span>
                        </div>
                        <div class="allocation-item">
                            <span>House fund in 1 year</span>
                            <span class="allocation-amount">€2,936</span>
                        </div>
                        <div class="allocation-item">
                            <span>Kids fund in 1 year</span>
                            <span class="allocation-amount">€3,294</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let processedData = null;
        let selectedFiles = [];
        
        // Tab Management
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }
        
        // File Upload Handling
        document.getElementById('fileInput').addEventListener('change', function(e) {
            selectedFiles = Array.from(e.target.files);
            updateProcessButton();
            
            if (selectedFiles.length > 0) {
                document.getElementById('uploadText').textContent = 
                    `${selectedFiles.length} file(s) selected - Ready to process`;
            }
        });
        
        function updateProcessButton() {
            const btn = document.getElementById('processBtn');
            btn.disabled = selectedFiles.length === 0;
        }
        
        // Bank Statement Processing
        async function processStatements() {
            const loading = document.getElementById('loading');
            const results = document.getElementById('processorResults');
            
            loading.style.display = 'block';
            results.style.display = 'none';
            
            // Simulate processing time
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            try {
                // Generate mock data based on files
                const mockData = generateMockData();
                processedData = mockData;
                displayProcessorResults(mockData);
                
                loading.style.display = 'none';
                results.style.display = 'block';
                
                showStatus('Successfully processed bank statements!', 'success');
            } catch (error) {
                loading.style.display = 'none';
                showStatus('Error processing files: ' + error.message, 'error');
            }
        }
        
        function generateMockData() {
            // Simulate realistic data based on your budget
            const totalBalance = 3116.62; // Sum of all accounts
            const monthlyIncome = 5840;
            const monthlyExpenses = 5583;
            const netChange = monthlyIncome - monthlyExpenses;
            
            const transactions = [
                { date: '2025-06-05', description: 'Derek Salary Payment', category: 'Income', amount: 4300.00, account: 'Personal' },
                { date: '2025-06-05', description: 'Derek Gift', category: 'Income', amount: 300.00, account: 'Personal' },
                { date: '2025-06-04', description: 'Iris Salary', category: 'Income', amount: 1240.00, account: 'Personal' },
                { date: '2025-06-03', description: 'Transfer to VL Account', category: 'Transfer', amount: -2382.78, account: 'Personal' },
                { date: '2025-06-03', description: 'Transfer to Joint Account', category: 'Transfer', amount: -1800.00, account: 'Personal' },
                { date: '2025-06-02', description: 'Mortgage Payment', category: 'Housing', amount: -1456.00, account: 'Fixed Costs' },
                { date: '2025-06-02', description: 'Utilities Package', category: 'Utilities', amount: -324.40, account: 'Fixed Costs' },
                { date: '2025-06-01', description: 'Insurance Premium', category: 'Insurance', amount: -356.71, account: 'Fixed Costs' },
                { date: '2025-06-05', description: 'Grocery Shopping', category: 'Groceries', amount: -156.78, account: 'Joint Family' },
                { date: '2025-06-04', description: 'Kids Clothing', category: 'Kids', amount: -89.90, account: 'Joint Family' },
                { date: '2025-06-03', description: 'Family Restaurant', category: 'Dining', amount: -67.50, account: 'Joint Family' }
            ];
            
            return {
                totalBalance,
                monthlyIncome,
                monthlyExpenses,
                netChange,
                transactions: transactions.sort((a, b) => new Date(b.date) - new Date(a.date))
            };
        }
        
        function displayProcessorResults(data) {
            document.getElementById('detectedBalance').textContent = formatCurrency(data.totalBalance);
            document.getElementById('detectedIncome').textContent = formatCurrency(data.monthlyIncome);
            document.getElementById('detectedExpenses').textContent = formatCurrency(data.monthlyExpenses);
            
            // Calculate recommended pocket money based on excess
            const excessAfterFixed = Math.max(0, data.monthlyIncome - 5400);
            const recommendedPocketMoney = Math.min(300, 200 + (excessAfterFixed * 0.1));
            document.getElementById('recommendedPocket').textContent = formatCurrency(recommendedPocketMoney);
            
            // Update transaction count
            document.getElementById('transactionCount').textContent = `${data.transactions.length} transactions`;
            
            // Update transactions table
            const tbody = document.getElementById('transactionsBody');
            tbody.innerHTML = '';
            
            data.transactions.forEach(transaction => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${formatDate(transaction.date)}</td>
                    <td>${transaction.description}</td>
                    <td>${transaction.account}</td>
                    <td>${transaction.category}</td>
                    <td class="${transaction.amount >= 0 ? 'amount-positive' : 'amount-negative'}">
                        ${formatCurrency(transaction.amount)}
                    </td>
                `;
            });
        }
        
        // Update Dashboard from Processed Data
        function updateBudgetFromStatements() {
            if (!processedData) return;
            
            // Update dashboard with actual data
            document.getElementById('dashboardIncome').textContent = formatCurrency(processedData.monthlyIncome);
            document.getElementById('totalMonthlyIncome').textContent = formatCurrency(processedData.monthlyIncome);
            
            // Calculate Iris income (total - Derek's fixed income)
            const irisActual = processedData.monthlyIncome - 4600;
            document.getElementById('irisIncome').textContent = formatCurrency(irisActual);
            
            // Update available for savings
            const availableForSavings = Math.max(0, processedData.monthlyIncome - 5400);
            document.getElementById('dashboardSavings').textContent = formatCurrency(availableForSavings);
            
            // Update allocations
            document.getElementById('houseFund').textContent = formatCurrency(availableForSavings * 0.30);
            document.getElementById('kidsFund').textContent = formatCurrency(availableForSavings * 0.25);
            document.getElementById('investingFund').textContent = formatCurrency(availableForSavings * 0.45);
            
            // Update buffer status
            const bufferNeeded = Math.max(0, 5400 - processedData.monthlyIncome);
            if (bufferNeeded > 0) {
                document.getElementById('bufferStatus').textContent = 
                    `Need to withdraw €${bufferNeeded} from buffer this month`;
                document.getElementById('bufferStatus').style.color = '#f39c12';
            } else {
                document.getElementById('bufferStatus').textContent = 
                    `Buffer is stable - income sufficient for this month`;
            }
            
            // Update alerts
            updateAlerts(processedData);
            
            // Switch to dashboard
            showTab('dashboard');
            document.querySelector('[onclick="showTab(\'dashboard\')"]').classList.add('active');
            
            showStatus('Dashboard updated with actual bank data!', 'success');
        }
        
        function updateAlerts(data) {
            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = '';
            
            // Income check
            if (data.monthlyIncome >= 5400) {
                alertsContainer.innerHTML += `
                    <div class="status-message status-success">
                        ✅ Income (${formatCurrency(data.monthlyIncome)}) covers all fixed costs
                    </div>
                `;
            } else {
                alertsContainer.innerHTML += `
                    <div class="status-message status-warning">
                        ⚠️ Income below minimum - using €${formatCurrency(5400 - data.monthlyIncome)} from buffer
                    </div>
                `;
            }
            
            // Pocket money check
            const excess = Math.max(0, data.monthlyIncome - 5400);
            if (excess >= 300) {
                alertsContainer.innerHTML += `
                    <div class="status-message status-success">
                        ✅ Sufficient excess for full €300 pocket money + €${formatCurrency(excess - 300)} savings
                    </div>
                `;
            } else if (excess >= 200) {
                alertsContainer.innerHTML += `
                    <div class="status-message status-warning">
                        ⚠️ Limited excess - consider €${formatCurrency(excess)} pocket money this month
                    </div>
                `;
            }
        }
        
        // Monthly Allocation Calculator
        function calculateAllocations() {
            const derekIncome = parseFloat(document.getElementById('derekIncome').value) || 0;
            const irisIncome = parseFloat(document.getElementById('irisIncomeInput').value) || 0;
            const totalIncome = derekIncome + irisIncome;
            
            document.getElementById('calculatedIncome').textContent = totalIncome.toLocaleString();
            
            // Calculate excess and buffer needs
            const excessOver5400 = Math.max(0, totalIncome - 5400);
            const bufferNeeded = Math.max(0, 5400 - totalIncome);
            
            document.getElementById('excessAmount').textContent = formatCurrency(excessOver5400);
            
            // Update buffer check
            const bufferCheck = document.getElementById('bufferCheck');
            if (bufferNeeded > 0) {
                bufferCheck.innerHTML = `
                    <div class="status-message status-warning">
                        ⚠️ Income (${formatCurrency(totalIncome)}) < Minimum (€5,400)<br>
                        Buffer action: <strong>Withdraw ${formatCurrency(bufferNeeded)}</strong>
                    </div>
                `;
            } else {
                bufferCheck.innerHTML = `
                    <div class="status-message status-success">
                        ✅ Income (${formatCurrency(totalIncome)}) ≥ Minimum (€5,400)<br>
                        Buffer action: <strong>None needed</strong>
                    </div>
                `;
            }
            
            // Show allocation results
            document.getElementById('allocationResults').style.display = 'grid';
            
            // Calculate excess allocations
            document.getElementById('calcHouseFund').textContent = formatCurrency(excessOver5400 * 0.30);
            document.getElementById('calcKidsFund').textContent = formatCurrency(excessOver5400 * 0.25);
            document.getElementById('calcInvestingFund').textContent = formatCurrency(excessOver5400 * 0.45);
            document.getElementById('totalAdditionalSavings').textContent = formatCurrency(excessOver5400);
        }
        
        // Auto-calculate when income inputs change
        document.getElementById('derekIncome').addEventListener('input', calculateAllocations);
        document.getElementById('irisIncomeInput').addEventListener('input', calculateAllocations);
        
        // Export Functions
        function exportComprehensiveData() {
            if (!processedData) return;
            
            const exportData = [
                ['Family Budget Analysis', formatDate(new Date())],
                [''],
                ['=== ACCOUNT BALANCES ==='],
                ['Personal Account', '€1,847.50'],
                ['Fixed Costs Account', '€245.67'],
                ['Joint Family Account', '€1,023.45'],
                ['Total Current Balance', formatCurrency(processedData.totalBalance)],
                [''],
                ['=== MONTHLY SUMMARY ==='],
                ['Total Income', formatCurrency(processedData.monthlyIncome)],
                ['Total Expenses', formatCurrency(processedData.monthlyExpenses)],
                ['Net Change', formatCurrency(processedData.netChange)],
                [''],
                ['=== RECOMMENDED ALLOCATIONS ==='],
                ['Pocket Money (€150 each)', '€300.00'],
                ['Available for Additional Savings', formatCurrency(Math.max(0, processedData.monthlyIncome - 5400))],
                [''],
                ['=== DETAILED TRANSACTIONS ==='],
                ['Date', 'Description', 'Account', 'Category', 'Amount'],
                ...processedData.transactions.map(t => [
                    formatDate(t.date), t.description, t.account, t.category, formatCurrency(t.amount)
                ])
            ];
            
            downloadCSV(exportData, 'family_budget_complete_analysis.csv');
            showStatus('Complete budget analysis exported!', 'success');
        }
        
        // Utility Functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('nl-NL', {
                style: 'currency',
                currency: 'EUR'
            }).format(amount);
        }
        
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('nl-NL');
        }
        
        function downloadCSV(data, filename) {
            const csvContent = data.map(row => 
                row.map(cell => 
                    typeof cell === 'string' && cell.includes(',') ? `"${cell}"` : cell
                ).join(',')
            ).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function showStatus(message, type) {
            const statusDiv = document.createElement('div');
            statusDiv.className = `status-message status-${type}`;
            statusDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(statusDiv, container.firstChild);
            
            setTimeout(() => statusDiv.remove(), 5000);
        }
        
        // Initialize with default calculations
        document.addEventListener('DOMContentLoaded', function() {
            calculateAllocations();
        });
    </script>
</body>
</html>